import streamlit as st
import math

# =============================
# LANGUE
# =============================

lang = st.sidebar.selectbox("ğŸŒ Language / Langue", ["FranÃ§ais ğŸ‡«ğŸ‡·", "English ğŸ‡¬ğŸ‡§"])

FR = lang == "FranÃ§ais ğŸ‡«ğŸ‡·"

# =============================
# FONCTIONS
# =============================

def bsa_mosteller(weight, height):
    return math.sqrt((weight * height) / 3600)

def z_score(measured, mean, sd):
    return (measured - mean) / sd

# =============================
# NORMES (approximations cliniques)
# =============================

def coronary_norms(bsa):
    return {
        "LMCA": {"mean": 2.4 * bsa**0.5, "sd": 0.3},
        "LAD":  {"mean": 2.3 * bsa**0.5, "sd": 0.3},
        "RCA":  {"mean": 2.2 * bsa**0.5, "sd": 0.3}
    }

def lv_mass_norms(bsa):
    return 60 * bsa, 10

def interpret_z(z):
    if z < 2:
        return "Normal" if FR else "Normal"
    elif 2 <= z < 2.5:
        return "Dilatation lÃ©gÃ¨re" if FR else "Mild dilatation"
    elif 2.5 <= z < 5:
        return "AnÃ©vrysme moyen" if FR else "Medium aneurysm"
    else:
        return "AnÃ©vrysme gÃ©ant" if FR else "Giant aneurysm"

# =============================
# TITRE
# =============================

st.set_page_config(page_title="Z-score Echo PÃ©diatrique", layout="centered")

st.title(
    "ğŸ«€ Z-score Ã‰chocardiographie Cardiaque PÃ©diatrique"
    if FR else
    "ğŸ«€ Pediatric Echocardiography Z-score"
)

# =============================
# DONNÃ‰ES PATIENT
# =============================

st.header("ğŸ“Š DonnÃ©es anthropomÃ©triques" if FR else "ğŸ“Š Anthropometric data")

weight = st.number_input("Poids (kg)" if FR else "Weight (kg)", min_value=1.0, value=20.0)
height = st.number_input("Taille (cm)" if FR else "Height (cm)", min_value=50.0, value=110.0)

bsa = bsa_mosteller(weight, height)
st.success(
    f"Surface corporelle (BSA) : {bsa:.2f} mÂ²"
    if FR else
    f"Body Surface Area (BSA): {bsa:.2f} mÂ²"
)

# =============================
# MESURES CORONAIRES
# =============================

st.header("ğŸ©º Mesures coronaires" if FR else "ğŸ©º Coronary measurements")

lmca = st.number_input(
    "Tronc coronaire gauche (TCG)" if FR else "Left main coronary artery (LMCA)", value=2.0
)
lad = st.number_input(
    "ArtÃ¨re interventriculaire antÃ©rieure (IVA)" if FR else "Left anterior descending (LAD)", value=3.0
)
rca = st.number_input(
    "Coronaire droite (CD)" if FR else "Right coronary artery (RCA)", value=2.0
)

# =============================
# MASSE VG
# =============================

st.header("ğŸ«€ Ventricule gauche" if FR else "ğŸ«€ Left ventricle")

lv_mass = st.number_input(
    "Masse ventriculaire gauche (g)" if FR else "Left ventricular mass (g)", value=45.0
)

# =============================
# CALCULS
# =============================

norms = coronary_norms(bsa)

z_lmca = z_score(lmca, norms["LMCA"]["mean"], norms["LMCA"]["sd"])
z_lad  = z_score(lad,  norms["LAD"]["mean"],  norms["LAD"]["sd"])
z_rca  = z_score(rca,  norms["RCA"]["mean"],  norms["RCA"]["sd"])

lvmi = lv_mass / bsa
lv_mean, lv_sd = lv_mass_norms(bsa)
z_lv = z_score(lv_mass, lv_mean, lv_sd)

# =============================
# RÃ‰SULTATS
# =============================

st.header("ğŸ“ˆ RÃ©sultats" if FR else "ğŸ“ˆ Results")

st.write(f"**TCG / LMCA Z-score** : {z_lmca:.2f} â†’ {interpret_z(z_lmca)}")
st.write(f"**IVA / LAD Z-score** : {z_lad:.2f} â†’ {interpret_z(z_lad)}")
st.write(f"**CD / RCA Z-score** : {z_rca:.2f} â†’ {interpret_z(z_rca)}")

st.divider()

st.write(
    f"**Masse VG indexÃ©e** : {lvmi:.1f} g/mÂ²"
    if FR else
    f"**Indexed LV mass** : {lvmi:.1f} g/mÂ²"
)
st.write(f"**Z-score masse VG** : {z_lv:.2f}")

if z_lv < 2:
    st.success(
        "Pas dâ€™hypertrophie ventriculaire gauche"
        if FR else
        "No left ventricular hypertrophy"
    )
else:
    st.warning(
        "Hypertrophie ventriculaire gauche"
        if FR else
        "Left ventricular hypertrophy"
    )

# =============================
# CONCLUSION
# =============================

st.header("ğŸ“ Conclusion" if FR else "ğŸ“ Conclusion")

st.markdown(f"""
- **BSA** : {bsa:.2f} mÂ²  
- **TCG / LMCA Z** : {z_lmca:.2f}  
- **IVA / LAD Z** : {z_lad:.2f}  
- **CD / RCA Z** : {z_rca:.2f}  
- **Masse VG indexÃ©e** : {lvmi:.1f} g/mÂ² (Z = {z_lv:.2f})

ğŸ‘‰ **{"Dilatation coronaire retenue si Z â‰¥ 2" if FR else "Coronary dilatation if Z â‰¥ 2"}**  
ğŸ‘‰ **{"HVG retenue si Z > 2" if FR else "LVH if Z > 2"}**
""")
